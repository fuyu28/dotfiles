# exec --no-startup-id ~/set_once.sh
# This file is a modified version based on default i3-config-wizard config
# source is available here:
# https://raw.githubusercontent.com/endeavouros-team/endeavouros-i3wm-setup/main/etc/skel/.config/i3/config
# Maintainer: joekamprad [joekamprad //a_t// endeavouros.com]
# https://endeavouros.com
#
# iconic font icon search: https://fontawesome.com/v4.7/cheatsheet/
#
# --> to update this run the following command (will backup existing setup file)
# wget --backups=1 https://raw.githubusercontent.com/endeavouros-team/endeavouros-i3wm-setup/main/etc/skel/.config/i3/config -P ~/.config/i3/
#
# Endeavouros-i3 config file
# Source for complete framework of our i3 config and theming here: https://github.com/endeavouros-team/endeavouros-i3wm-setup
# EndeavourOS wiki holds some Information also: https://discovery.endeavouros.com/window-tiling-managers/i3-wm/
# Please see http://i3wm.org/docs/userguide.html for the official i3 reference!

#######################
# config starts here: #
#######################

# Font for window titles. Will also be used by the bar unless a different font
# is used in the bar {} block below.
# This font is widely installed, provides lots of unicode glyphs, right-to-left
# text rendering and scalability on retina/hidpi displays (thanks to pango).
font pango:Noto Sans 11

# set the mod key to the winkey:
set $mod Mod4
set $term kitty

##############################
# workspace naming/behavior: #
##############################

# Define names for default workspaces for which we configure key bindings later on.
# We use variables to avoid repeating the names in multiple places.
set $ws1 "1"
set $ws2 "2"
set $ws3 "3"
set $ws4 "4"
set $ws5 "5"
set $ws6 "6"
set $ws7 "7"
set $ws8 "8"
set $ws9 "9"
set $ws10 "10"

#####################
# workspace layout: #
#####################

# default i3 tiling mode:
workspace_layout default

##############################
# extra options for windows: #
##############################

#border indicator on windows:
default_border pixel 2

# Set inner/outer gaps
gaps inner 6
gaps outer 3

# Use Mouse+$mod to drag floating windows to their wanted position
floating_modifier $mod

focus_follows_mouse no

######################################
# keybindings for different actions: #
######################################

# change borders
bindsym $mod+u border none
bindsym $mod+y border pixel 1
bindsym $mod+n border normal

# apps & launchers
bindsym $mod+Return exec $term
bindsym $mod+Shift+q kill
bindsym $mod+d exec --no-startup-id rofi -modi drun -show drun -config ~/.config/rofi/rofidmenu.rasi
bindsym $mod+z exec --no-startup-id morc_menu

# sound controls
bindsym $mod+Ctrl+m exec $term -e 'alsamixer'
bindsym XF86AudioRaiseVolume exec --no-startup-id pamixer -i 5 && notify-send "Vol ↑ $(pamixer --get-volume)%"
bindsym XF86AudioLowerVolume exec --no-startup-id pamixer -d 5 && notify-send "Vol ↓ $(pamixer --get-volume)%"
bindsym XF86AudioMute        exec --no-startup-id pamixer -t && notify-send "Mute $(pamixer --get-mute)"
bindsym XF86AudioPlay        exec --no-startup-id playerctl play-pause

# brightness controls
bindsym XF86MonBrightnessUp   exec --no-startup-id brightnessctl set +10% && notify-send "Brightness ↑"
bindsym XF86MonBrightnessDown exec --no-startup-id brightnessctl set 10%- && notify-send "Brightness ↓"

# application shortcuts
bindsym $mod+Ctrl+b exec $term -e 'bmenu'
bindsym $mod+F2 exec --no-startup-id firefox
bindsym $mod+F3 exec --no-startup-id thunar
bindsym $mod+Shift+F3 exec --no-startup-id pkexec thunar
bindsym $mod+F5 exec $term -e 'mocp'
bindsym $mod+t exec --no-startup-id pkill picom
bindsym $mod+Ctrl+t exec --no-startup-id picom -b
bindsym $mod+Shift+d --release exec "killall dunst; exec notify-send 'Restarted dunst'"
bindsym Print exec --no-startup-id ~/.local/bin/screenshot.sh region
bindsym $mod+Print exec --no-startup-id ~/.local/bin/screenshot.sh full
bindsym $mod+Shift+Print exec --no-startup-id ~/.local/bin/screenshot.sh window
bindsym $mod+Shift+x exec xdg-open /usr/share/doc/manjaro/i3_help.pdf
bindsym $mod+Ctrl+x --release exec --no-startup-id xkill
bindsym $mod+v exec --no-startup-id copyq show
bindsym $mod+p exec --no-startup-id code
bindsym $mod+Shift+n exec --no-startup-id $term -e "nmtui"
bindsym $mod+Escape exec --no-startup-id $term start -- btop
bindsym $mod+Shift+Escape exec --no-startup-id lxtask

# focus movement
bindsym $mod+h focus left
bindsym $mod+j focus down
bindsym $mod+k focus up
bindsym $mod+l focus right

# alternatively, you can use the cursor keys:
bindsym $mod+Left focus left
bindsym $mod+Down focus down
bindsym $mod+Up focus up
bindsym $mod+Right focus right

# move focused window
bindsym $mod+Shift+h move left
bindsym $mod+Shift+j move down
bindsym $mod+Shift+k move up
bindsym $mod+Shift+l move right

# alternatively, you can use the cursor keys:
bindsym $mod+Shift+Left move left
bindsym $mod+Shift+Down move down
bindsym $mod+Shift+Up move up
bindsym $mod+Shift+Right move right

# workspace back and forth (with/without active container)
# workspace_auto_back_and_forth yes
bindsym $mod+b workspace back_and_forth
bindsym $mod+Shift+b move container to workspace back_and_forth; workspace back_and_forth

# split orientation
bindsym $mod+o split h; exec --no-startup-id notify-send 'tile horizontally'
bindsym $mod+Shift+o split v; exec --no-startup-id notify-send 'tile vertically'
bindsym $mod+q split toggle

# toggle fullscreen mode for the focused container
bindsym $mod+f fullscreen toggle

# change container layout (stacked, tabbed, toggle split)
bindsym $mod+s layout stacking
bindsym $mod+w layout tabbed
bindsym $mod+e layout toggle split

# toggle tiling / floating
bindsym $mod+Shift+space floating toggle

# change focus between tiling / floating windows
bindsym $mod+space focus mode_toggle

# toggle sticky
bindsym $mod+Shift+s sticky toggle

# focus the parent container
bindsym $mod+a focus parent

# move the currently focused window to the scratchpad
bindsym $mod+Shift+minus move scratchpad

# Show the next scratchpad window or hide the focused scratchpad window.
# If there are multiple scratchpad windows, this command cycles through them.
bindsym $mod+minus scratchpad show

#navigate workspaces next / previous
bindsym $mod+Ctrl+Right workspace next
bindsym $mod+Ctrl+Left workspace prev

# switch to workspace
bindsym $mod+1 workspace $ws1
bindsym $mod+2 workspace $ws2
bindsym $mod+3 workspace $ws3
bindsym $mod+4 workspace $ws4
bindsym $mod+5 workspace $ws5
bindsym $mod+6 workspace $ws6
bindsym $mod+7 workspace $ws7
bindsym $mod+8 workspace $ws8

# Move focused container to workspace
bindsym $mod+Ctrl+1 move container to workspace $ws1
bindsym $mod+Ctrl+2 move container to workspace $ws2
bindsym $mod+Ctrl+3 move container to workspace $ws3
bindsym $mod+Ctrl+4 move container to workspace $ws4
bindsym $mod+Ctrl+5 move container to workspace $ws5
bindsym $mod+Ctrl+6 move container to workspace $ws6
bindsym $mod+Ctrl+7 move container to workspace $ws7
bindsym $mod+Ctrl+8 move container to workspace $ws8

# Move to workspace with focused container
bindsym $mod+Shift+1 move container to workspace $ws1; workspace $ws1
bindsym $mod+Shift+2 move container to workspace $ws2; workspace $ws2
bindsym $mod+Shift+3 move container to workspace $ws3; workspace $ws3
bindsym $mod+Shift+4 move container to workspace $ws4; workspace $ws4
bindsym $mod+Shift+5 move container to workspace $ws5; workspace $ws5
bindsym $mod+Shift+6 move container to workspace $ws6; workspace $ws6
bindsym $mod+Shift+7 move container to workspace $ws7; workspace $ws7
bindsym $mod+Shift+8 move container to workspace $ws8; workspace $ws8

# reload the configuration file
bindsym $mod+Shift+c reload

# restart i3 inplace (preserves your layout/session, can be used to upgrade i3)
bindsym $mod+Shift+r restart

# Set shut down, restart and locking features (shared with i3blocks)
bindsym $mod+0 exec --no-startup-id ~/.local/bin/rofi-powermenu.sh

# Resize window (you can also use the mouse for that)
bindsym $mod+r mode "resize"

# hide/unhide i3status bar
bindsym $mod+m bar mode toggle

#################
# mode helpers: #
#################

mode "resize" {
    # These bindings trigger as soon as you enter the resize mode
    # Pressing left will shrink the window's width.
    # Pressing right will grow the window's width.
    # Pressing up will shrink the window's height.
    # Pressing down will grow the window's height.
    bindsym h resize shrink width  5 px or 5 ppt
    bindsym l resize grow   width  5 px or 5 ppt
    bindsym j resize grow   height 5 px or 5 ppt
    bindsym k resize shrink height 5 px or 5 ppt

    # same bindings, but for the arrow keys
    bindsym Left resize shrink width 10 px or 10 ppt
    bindsym Down resize grow height 10 px or 10 ppt
    bindsym Up resize shrink height 10 px or 10 ppt
    bindsym Right resize grow width 10 px or 10 ppt

    # exit resize mode: Enter or Escape
    bindsym Return mode "default"
    bindsym Escape mode "default"
}

##################
# floating rules #
##################

# set floating (nontiling) for apps needing it
for_window [class="Yad" instance="yad"] floating enable

# set floating (nontiling) for special apps
for_window [class="Pavucontrol" instance="pavucontrol"] floating enable
for_window [class="qt5ct" instance="qt5ct"] floating enable
for_window [class="copyq"] floating enable
for_window [window_role="About"] floating enable

# Bitwarden 拡張ポップアップ（Brave）の隔離
for_window [window_role="pop-up" title="Bitwarden"] floating enable
for_window [window_role="pop-up" title="Bitwarden"] border pixel 2
for_window [window_role="pop-up" title="Bitwarden"] focus

#############################################
# autostart applications/services on login: #
#############################################

# make sure it loads gtk configs
exec_always $HOME/.config/i3/scripts/import-gsettings

## compositor

# aka transparency
# uncomment one of them to be used
# options could need changes, related to used GPU and drivers.
# to find the right setting consult the archwiki or ask at the forum.

# picom: https://wiki.archlinux.org/title/Picom
# manpage: https://man.archlinux.org/man/picom.1.en
# The default configuration is available in /etc/xdg/picom.conf
# For modifications, it can be copied to ~/.config/picom/picom.conf or ~/.config/picom.conf
# install picom package (sudo pacman -Syu picom)

# start using default config
#exec_always --no-startup-id picom -b

# for custom config:
#exec_always --no-startup-id picom --config  ~/.config/picom.conf


## applications/services

#get auth work with polkit-gnome
exec --no-startup-id /usr/lib/polkit-gnome/polkit-gnome-authentication-agent-1

# dex execute .desktop files + apps using /etc/xdg/autostart.
# when second to i3 a DE is installed or mixed usage of i3 + xfce4 or GNOME
# in this cases better disable dex and use manual starting apps using xdg/autostart
# if enabled you should comment welcome app.
# https://github.com/jceb/dex
#exec --no-startup-id dex -a -s /etc/xdg/autostart/:~/.config/autostart/
#exec --no-startup-id dex --autostart --environment i3

# manual autostart entries (from /etc/xdg/autostart), excluding duplicates/conflicts
exec --no-startup-id nm-applet
exec --no-startup-id /usr/lib/xapps/xapp-sn-watcher
exec --no-startup-id xdg-user-dirs-update
exec --no-startup-id /usr/bin/firewall-applet

# start welcome app
#exec --no-startup-id sh /usr/share/endeavouros/scripts/welcome --startdelay=3

# num lock activated
#exec --no-startup-id numlockx on

# configure multiple keyboard layouts and hotkey to switch (Alt+CAPSLOCK in this example)
#exec --no-startup-id setxkbmap -layout 'us,sk' -variant altgr-intl,qwerty -option 'grp:alt_caps_toggle'

# start conky:
#exec_always --no-startup-id conky

# display layout
{{ if eq .role "desktop" }}
exec --no-startup-id xrandr --output DP-0 --primary --left-of DP-2
workspace $ws1 output DP-0
workspace $ws2 output DP-2
{{ end }}

# common session helpers
exec --no-startup-id picom -b
exec --no-startup-id setxkbmap jp
exec --no-startup-id fcitx5 -d
exec --no-startup-id copyq --start-server

# set wallpaper
exec --no-startup-id sleep 1 && ~/.local/bin/set-wallpaper

# Power management:
#  - xidlehook handles idle detection, lock, and suspend
#  - X built-in screen saver / DPMS are disabled to avoid conflicts
exec --no-startup-id xset s off
exec --no-startup-id xset -dpms
{{ if eq .role "laptop" }}
exec --no-startup-id xidlehook \
    --timer 600  'betterlockscreen -l' '' \
    --timer 120  'xset dpms force off' '' \
    --timer 900  'systemctl suspend' ''
{{ else }}
exec --no-startup-id xidlehook \
    --timer 1800 'betterlockscreen -l' '' \
    --timer 300 'xset dpms force off' '' \
    --timer 5100 'systemctl suspend' ''
{{ end }}
# Desktop notifications

# dunst config used ~/.config/dunst/dunstrc
# set alternative config if needed:
#exec --no-startup-id /usr/bin/dunst --config ~/.config/dunst/dunstrc
# may need to run dbus-launch explicitly:
#exec --no-startup-id dbus-launch /usr/bin/dunst
exec --no-startup-id /usr/bin/dunst

######################################
# color settings for bar and windows #
######################################

# Define colors variables:
set $darkbluetrans  #08052be6
set $darkblue       #08052b
set $lightblue      #5294e2
set $urgentred      #e53935
set $white          #ffffff
set $black          #000000
set $purple         #e345ff
set $darkgrey       #383c4a
set $grey           #b0b5bd
set $mediumgrey     #8b8b8b
set $yellowbrown    #e1b700

# define colors for windows:
# class                      border      bground     text        indicator   child_border
client.focused          #d8a5ff #1e1b2e #ffffff #d8a5ff #d8a5ff
client.focused_inactive #6e6a86 #1e1b2e #b8b3cc #6e6a86 #6e6a86
client.unfocused        #4c4a63 #1e1b2e #9a97b0 #4c4a63 #4c4a63
client.urgent           #e06c75 #1e1b2e #f6d6d9 #e06c75 #e06c75

client.background       #1e1b2e

############################################
# bar settings (input comes from i3blocks) #
############################################

# Start i3bar to display a workspace bar
# (plus the system information i3status finds out, if available)
bar {
        font pango: Noto Sans Regular 10
        status_command i3blocks -c ~/.config/i3/i3blocks.conf
            position bottom
#           i3bar_command i3bar --transparency
# it could be that you have no primary display set: set one (xrandr --output <output> --primary)
# reference: https://i3wm.org/docs/userguide.html#_tray_output
            #tray_output primary
            tray_padding 0

# When strip_workspace_numbers is set to yes,
# any workspace that has a name of the form
# “[n][:][NAME]” will display only the name.
strip_workspace_numbers yes
##strip_workspace_name no

            colors {
            separator          $purple
            background         $darkgrey
            statusline         $white
#                           border              bg          txt         indicator
        focused_workspace   $mediumgrey         $grey       $darkgrey   $purple
        active_workspace    $lightblue          $mediumgrey $darkgrey   $purple
        inactive_workspace  $darkgrey           $darkgrey   $grey       $purple
        urgent_workspace    $urgentred          $urgentred  $white      $purple
    }
}

